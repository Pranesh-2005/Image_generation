<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Image Generator</title>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      width: 100%;
      max-width: 600px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .header { margin-bottom: 2rem; }
    h1 {
      color: #2d3748;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle { color: #718096; font-size: 1.1rem; margin-bottom: 2rem; }
    .input-group { position: relative; margin-bottom: 2rem; }
    input[type="text"] {
      width: 100%;
      padding: 1rem 1.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 15px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #f8fafc;
      color: #2d3748;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    input[type="text"]::placeholder { color: #a0aec0; }
    .button-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 1rem 2rem;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      min-width: 140px;
    }
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    button:active:not(:disabled) { transform: translateY(0); }
    .download-btn {
      background: linear-gradient(135deg, #48bb78, #38a169);
      display: none;
    }
    .download-btn:hover:not(:disabled) {
      box-shadow: 0 10px 25px rgba(72, 187, 120, 0.3);
    }
    #status {
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .status-generating {
      background: #fef5e7;
      color: #d69e2e;
      border: 1px solid #f6e05e;
    }
    .status-success {
      background: #f0fff4;
      color: #38a169;
      border: 1px solid #9ae6b4;
    }
    .status-error {
      background: #fed7d7;
      color: #e53e3e;
      border: 1px solid #feb2b2;
    }
    .image-container {
      margin-top: 2rem;
      position: relative;
      display: none;
    }
    #result-image {
      width: 100%;
      max-width: 100%;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }
    #result-image:hover { transform: scale(1.02); }
    .loading-spinner {
      display: none;
      width: 40px;
      height: 40px;
      border: 4px solid #e2e8f0;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 1rem auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 768px) {
      .container { padding: 1.5rem; margin: 0.5rem; }
      h1 { font-size: 2rem; }
      .subtitle { font-size: 1rem; }
      .button-group { flex-direction: column; align-items: center; }
      button { width: 100%; max-width: 300px; }
    }
    @media (max-width: 480px) {
      .container { padding: 1rem; }
      h1 { font-size: 1.8rem; }
      input[type="text"] { padding: 0.8rem 1rem; }
      button { padding: 0.8rem 1.5rem; }
    }
    @media (prefers-color-scheme: dark) {
      .container { background: rgba(45, 55, 72, 0.95); color: #e2e8f0; }
      input[type="text"] { background: #4a5568; border-color: #718096; color: #e2e8f0; }
      input[type="text"]:focus { background: #2d3748; border-color: #667eea; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>AI Image Generator</h1>
      <p class="subtitle">Transform your ideas into stunning visuals with AI</p>
    </div>
    <div class="input-group">
      <input type="text" id="prompt-input" placeholder="Describe the image you want to create...">
    </div>
    <div class="button-group">
      <button id="generate-btn">‚ú® Generate Image</button>
      <button id="download-btn" class="download-btn">üì• Download</button>
    </div>
    <div class="loading-spinner" id="loading-spinner"></div>
    <p id="status"></p>
    <div class="image-container" id="image-container">
      <img id="result-image" alt="Generated Image">
    </div>
  </div>

<script type="module">
import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

const promptInput = document.getElementById("prompt-input");
const generateBtn = document.getElementById("generate-btn");
const downloadBtn = document.getElementById("download-btn");
const statusText = document.getElementById("status");
const resultImage = document.getElementById("result-image");
const imageContainer = document.getElementById("image-container");

let client;
let clientReady = false;
let currentImageUrl = "";

// Connect once
(async () => {
  try {
    client = await Client.connect("PraneshJs/ImageGeneration");
    clientReady = true;
    generateBtn.disabled = false;
  } catch (error) {
    statusText.textContent = "‚ùå Failed to connect to AI service.";
    generateBtn.disabled = true;
    console.error(error);
  }
})();

generateBtn.disabled = true; // Disable until client is ready

generateBtn.addEventListener("click", async () => {
  if (!clientReady) {
    statusText.textContent = "‚è≥ Connecting to AI service. Please wait...";
    return;
  }

  const prompt = promptInput.value.trim();
  if (!prompt) {
    statusText.textContent = "‚ö†Ô∏è Please enter a prompt!";
    return;
  }

  statusText.textContent = "‚è≥ Generating image...";
  generateBtn.disabled = true;
  resultImage.style.display = "none";
  imageContainer.style.display = "none";
  downloadBtn.style.display = "none";

  try {
    const result = await client.predict("/predict", { 
      prompt: prompt
    });

    console.log("API result:", result);

    // result.data is an array: [image_object]
    let imageObj = result.data[0];
    let imageUrl = "";

    if (typeof imageObj === "object" && imageObj !== null) {
      imageUrl = imageObj.url || imageObj.path || imageObj.src || "";
    } else if (typeof imageObj === "string") {
      imageUrl = imageObj;
    }

    if (typeof imageUrl === "string" && (imageUrl.startsWith("http://") || imageUrl.startsWith("https://"))) {
      resultImage.src = imageUrl;
      resultImage.style.display = "block";
      imageContainer.style.display = "block";
      downloadBtn.style.display = "inline-block";
      currentImageUrl = imageUrl;
      statusText.textContent = "‚úÖ Image generated!";
    } else if (typeof imageUrl === "string" && imageUrl.toLowerCase().includes("error")) {
      statusText.textContent = "‚ùå Backend error: Could not generate image. Please try again later.";
      imageContainer.style.display = "none";
      downloadBtn.style.display = "none";
      currentImageUrl = "";
    } else {
      statusText.textContent = "‚ùå Failed to get a valid image URL.";
      imageContainer.style.display = "none";
      downloadBtn.style.display = "none";
      currentImageUrl = "";
    }
  } catch (err) {
    console.error(err);
    statusText.textContent = "‚ùå Error generating image. Please try again.";
    imageContainer.style.display = "none";
    downloadBtn.style.display = "none";
    currentImageUrl = "";
  } finally {
    generateBtn.disabled = false;
  }
});

downloadBtn.addEventListener("click", async () => {
  if (!currentImageUrl) return;
  try {
    const response = await fetch(currentImageUrl);
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "generated-image.png";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  } catch (err) {
    statusText.textContent = "‚ùå Failed to download image.";
    console.error(err);
  }
});
</script>
</body>
</html>